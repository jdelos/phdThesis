\chapter[Modeling of H-SCC]{Modeling of Hybrid Switched Capacitor Converters}

Switch capacitor converters are circuits composed by a large number of switches and capacitors, and require accurate models to properly design them. SCCs have the peculiarity to be lossy by nature due to the non adiabatic energy transfer between capacitors, phenomenon not present in the inductor based converters. Generally, modeling of SCCs focuses just on  the description of the loss mechanisms associated to conduction and capacitor charge transfer, neglecting other sources of loss such as driving and switching loss. These loss mechanisms are proportional to the output current, thus are normally modeled with resistor in the well known output impedance model.

This chapter presents a new methodology to model a SCC when any of the nodes in the converter are loaded. The proposed methodology also include the effects of PWM control, thus accurately predicting the equivalent internal impedance and the converter conversion ratio.

The chapter is divided in two sections, the first section is devoted to the study and model a SCC when loaded from a \emph{pwm}-node, reviewing and extending the charge flow analysis~\cite{95Makowski,Seeman:EECS-2009-78} to include two new aspects that arise with the proposed hybrid converter. First, any of the nodes of the converter are considered as possible outputs that can be loaded. Second, the analysis includes the effects of duty cycle (PWM) in any of the operation regimes of the converter, and this alters the conversion ratio and the internal equivalent impedance. The previous models are discussed, and the limiting are factors identifying. Subsequently the charge flow analysis is reformulated using a new approach based on current-loaded outputs that leads a better accuracy and covers the analysis of both SCC and H-SCC. The new model is compared to circuit simulations and experimental data.

The second section is devoted to the study of multiple loaded H-SCC. Based on the well-known output impedance model, a new circuit representation for converters with multiple current-loaded outputs is presented. The related characterization methodology is developed to determine the parameters of said new model based on the current-loaded analysis presented in the first section. The resulting model is validated against simulation and experimental data.


\section{Single Output Converters}
Switched Capacitor Converters has been always treated as a two-port converter with single input and a single output as shown in Fig.\ref{fig:two_port}. The input port is connected to a voltage source and the output port feeds the load. The SCC provides between input, $v_i$, and output, $v_o$, a voltage conversion, $m$,  that  steps up, steps down or/and inverts the polarity of the input voltage. Up to present all the circuit theory devoted SCCs is valid only for the two-port configuration, therefore this section is dedicated to revisit the classical concepts of single output SCC and to introduce new ones that enable to study the H-SCC.

\begin{figure}[!h]
\centering
\ctikzset { bipoles/length=1cm}
\begin{circuitikz}[american voltages,scale=0.65]
\draw
    (1,0) to[short,o-]
    (0,0) to[V = $V_{supply}$]
    (0,3) to[short,-o]
    (1,3) ;

\draw
    (2,3) --
    (2.5,3)

    (2,0) --
    (2.5,0)

    node[ocirc]  (IC)  at (2,0) {}
    node[ocirc]  (I) at (2,3) {}
    (I) to[open,v=$v_{i}$] (IC);


\draw [thick]
    (2.5,-0.5) --
    (2.5,3.5)  --
    (5.5,3.5)  --
    (5.5,-0.5) --
    (2.5,-0.5);

\draw (4,2)node[anchor=north]{$\frac{v_o}{v_{i}}=m$} ;
\draw
    (5.5,3) -- (6,3)
    (5.5,0) -- (6,0)
    node[ocirc]  (O)  at (6,3) {}
    node[ocirc]  (OC) at (6,0) {}
    (O) to[open,v^<=$v_{o}$] (OC);

\draw
    (7,0) to[short,o-]
    (8,0) to[ R= $Load$,mirror]
    (8,3) to[short,-o]
    (7,3) ;
\end{circuitikz}
\caption{General two port configuration of a Switched Capacitor Converter. }
\label{fig:two_port}
\end{figure}

\subsection{The Output Impedance Model}
\begin{SCfigure}%[!h]
\centering
\ctikzset { bipoles/length=1cm}
\begin{circuitikz}[american voltages, scale=0.65]
\draw
    (-0.5,0) to[V = $ m \cdot v_{src}  $]
    (-0.50,3) -- (0,3) to[R,l=$r_{scc}$,-o]  (3,3)
    (3.5,3) to[short,o-,i=$i_o$]
    (4.25,3)   to[R,l=$r_o$]
    (4.25,0) to[short,-o] (3.5,0)
    (3,0) to[short,o-] (-0.5,0)
    (0,3) to[open,v^=$v_{trg}$] (0,0)
    (3.5,3) to[open,v=$v_{out}$] (3.5,0);

\end{circuitikz}
\caption{Output impedance model of a switched capacitor converter.}
\label{fig:scc_model_oi}
\end{SCfigure}
The behavior of SSCs is modeled with the well-known output impedance model~\cite{2000Oota,2012Peter} that is composed of a controlled voltage source and equivalent resistance $r_{scc}$, as shown in figure~\ref{fig:scc_model_oi}.The output voltage provided by the converter under no-load conditions is defined as \emph{target voltage} ($v_{trg}$). It is modeled with the controlled voltage source, being the value of voltage supply $v_{src}$ multiplied by the conversion ratio $m$, thus
\begin{equation}
v_{trg} =  m \cdot v_{src} .
\label{eq:vtrg}
\end{equation}

When loaded, the voltage droop across $r_{scc}$ accounts for the loss produced in the converter. In fact, the loss are proportional to the output current $i_o$, that is why they are represented with a resistor. Hence the output voltage of the converter can be obtained as
\begin{equation}
v_{out} =  m \cdot v_{src} - i_o \cdot r_{scc} .
\label{eq:vout_scc}
\end{equation}

Up to day, there are two different methodologies to infer the equivalent output resistance $r_{scc}$, plotted in~\ref{fig:plot_rscc}. On the one hand, S. Ben-Yaakov  ~\cite{2009Ben-Yaakov,2012Ben-Yaakov,2013Evzelman} has claimed a generalized methodology based on the analytical solution of each of the different R-C transient circuits of the converter, reducing all of them to a single transient solution. The methodology achieves a high accuracy, but yields to a set of none linear equations and high complexity for the analysis of advanced architectures.

On the other hand,  M. Makowski and D. Maksimovic~\cite{95Makowski} presented a methodology based on the analysis of the charge flow between capacitors in steady-state. The methodology is simple to apply and yields with a set of linear expressions, being them easy to operate for further analysis of the converters. Based on the charge flow analysis, M.Seeman~\cite{Seeman:EECS-2009-78} developed different metrics allowing to compare performances between capacitive and inductive converters.

Although both methodologies are valid in the modeling of SCCs, none of them has been used to model the effects of a loaded \emph{pwm}-node, which is fundamental to study the H-SCC.  Nevertheless the charge flow analysis has a more clean and simplified way of describing the loss mechanism, based on the hypothesis that a SCC in steady-state has to have null charge balance in all the capacitors. That is why this methodology has been chosen in to model the H-SCC, although few modeling hypothesis have been reviewed and modified according to the operation of the new \emph{hybrid} switched capacitor converter.

\sidecaptionvpos{figure}{!b}
\begin{SCfigure} %[!h]
\centering
\begin{tikzpicture}[scale=0.85]
    \begin{loglogaxis}[
        %width=12cm,
        %height=8cm,
        xlabel near ticks,
        ylabel near ticks,
        xlabel= {$f_{sw} ~~ [Hz] $},
        ylabel= {$ [\Omega] $} ,
        axis line style={->},
        axis y line*=left,
        axis x line*=bottom,
        xtick=\empty, ytick=\empty,
        %ytick = {0,.125,.25},
        %yticklabels={0,$v_{src}\frac{1}{3}$,$v_{src}\frac{2}{3}$,$v_{src}$},
        domain=3e4:5e6,
        samples=100,
        %xticklabels={0,$D \cdot T_{sw}$,$T_{sw}$ ,$2 T_{sw}$,$3 T_{sw} $},
        legend style={at={(0.75,0.75)}, anchor= north east},
        enlarge x limits={0.0},
        enlarge y limits={0.0}
        ]

  \newcommand\C{1e-6}
  \newcommand\Resr{1}
  \newcommand\Dx{0.5}
  \newcommand\Rfsl{4*\Resr}
  \newcommand\lbssl{1e5}
  \newcommand\lbfsl{1e6}

  \addplot [thick]   { 1/(2*x*\C)*((exp(\Dx/(\Resr*x*\C))+1)/(exp(\Dx/(\Resr*x*\C))-1) + (exp((1-\Dx)/(\Resr*x*\C))+1)/(exp((1-\Dx)/(\Resr*x*\C))-1))};
  %\addplot [thick,dashed,marker=square] { sqrt((1/(2*\C*x))^2 + \Rfsl^2) };
  \addplot [thick,dashed,domain=3e4:3.5e5] { (1/(\C*x) };
  \addplot [thick,dotted,domain=2.5e4:5e6] { \Rfsl+0*x };
\legend {$r_{scc}$,$r_{ssl}$,$r_{fsl}$};
\end{loglogaxis}

\node[anchor=north] at (6.25cm,1.35cm){$FSL$};
\node[anchor=north,rotate=-60] at (1.25cm,5cm){$SSL$};

\end{tikzpicture}
\caption{SCC Equivalent output resistance $r_{scc}$ as function of the frequency and the two asymptotic limits: \emph{Slow Switching Limit} (SSL) and \emph{Fast Switching Limit}(FSL). }
\label{fig:plot_rscc}
\end{SCfigure}

As aforementioned $r_{scc}$ accounts for the loss when the converter is loaded. All losses in the converter are, in fact, dissipated in the resistive elements of the converter: \emph{on}-resistance $r_{on}$ of the switches and equivalent series resistance $r_{esr}$ of the capacitors, thus all loesses represented by $r_{scc}$ are conduction losses. Nevertheless, the origin and magnitude of the losses depends on the operation region of the converter, which is function of the switching frequency as shown in the plot of Figure~\ref{fig:plot_rscc}. 

There are two well-defined operation regimes of the converter: the \emph{Slow Switching Limit} (SSL) and the \emph{Fast Switching Limit} (FSL), and each of the regime defines an asymptotic limit of the $r_{scc}$ curve. In SSL, the converter operates at a switching frequency $f_{sw}$ much lower than the time constant $\tau$ of the converter, thereby allowing the full charge and discharge of the capacitors as shown in Figure~\ref{fig:ic_ssl}. As shown in Figure~\ref{fig:ic_fsl} currents have exponential-shape waveforms. The losses are then determined by the charge transfer between capacitors, but dissipated in the resistive paths of the converter mainly in switch $r_{on}$. Therefore reducing the switch resistance will not reduce the losses, instead will produce sharper discharge currents in the switches producing more EMI. In that region $r_{scc}$ losses are inversely proportional of product between the switching frequency and capacitances, limited by the SSL asymptote (see Figure~\ref{fig:plot_rscc}).

In FSL, the converter operates with a switching frequency $f_{sw}$ much higher than the time constant $\tau$ of the converter, limiting the charge and discharge transient times of the capacitors; as shown in Figure~\ref{fig:ic_fsl} currents have block-shape waveforms. In such conditions losses totally depend on the parasitic resistive elements ($r_{on}$, $r_{esr}$), therefore changes in the capacitances or frequency do not modify the produces losses. In that region $r_{scc}$ is constant and limited by the FSL asymptote (see Figure~\ref{fig:plot_rscc}).

\begin{figure}[!h]
\centering
\ctikzset { bipoles/length=1cm}
\begin{subfigure}[t]{.45\textwidth}
    %\centering
    \raggedright
    \begin{tikzpicture} 
            \begin{axis}[
                width={\textwidth},
                height={6cm},
                axis lines=middle,
                xlabel near ticks,
                ylabel near ticks,
                xlabel= {$time $},
                ylabel= {capacitor current},
                every axis x label/.style={
                    at={(ticklabel* cs:1.05)},
                    anchor=west,
                },
                x axis line style={->},
                y axis  line style={<->},
                xtick=\empty, ytick=\empty,
                %ytick = {0,.125,.25},
                %yticklabels={0,$v_{src}\frac{1}{3}$,$v_{src}\frac{2}{3}$,$v_{src}$},
                domain=-0.25:2,
                samples=100,
                %xticklabels={0,$D \cdot T_{sw}$,$T_{sw}$ ,$2 T_{sw}$,$3 T_{sw} $},
                xmin=-0.1,xmax=2.2,
                ymin=-1,ymax=1.2,
                ]

          \newcommand\xtauA{1/(3*5)};
          \newcommand\ioA{1};
          \newcommand\xtauB{3/(5*5)};
          \newcommand\ioB{-0.75};
          
          \addplot [thick,]   coordinates { (0,0) (0.1,0) (0.1,\ioA)};
          \addplot [thick,domain=0.1:1]   { \ioA*(  exp(-(x-0.1)/(\xtauA))) };
          \addplot [thick,domain=1:2]   coordinates { (1,0) (1,\ioB)};
          \addplot [thick,domain=1:2]   { \ioB*(  exp(-(x-1)/(\xtauB))) };
          
        
          
        \end{axis}
    \end{tikzpicture}
    \caption{Slow Switching Limit}
    \label{fig:ic_ssl}
\end{subfigure}
\hfill
\begin{subfigure}[t]{.45\textwidth}
    %\centering
    \raggedright
    \begin{tikzpicture} 
            \begin{axis}[
                width={\textwidth},
                height={6cm},
                axis lines=middle,
                xlabel near ticks,
                ylabel near ticks,
                xlabel= {$time $},
                ylabel= {capacitor current},
                every axis x label/.style={
                    at={(ticklabel* cs:1.05)},
                    anchor=west,
                },
                x axis line style={->},
                y axis  line style={<->},
                xtick=\empty, ytick=\empty,
                %ytick = {0,.125,.25},
                %yticklabels={0,$v_{src}\frac{1}{3}$,$v_{src}\frac{2}{3}$,$v_{src}$},
                domain=0:2.2,
                samples=100,
                %xticklabels={0,$D \cdot T_{sw}$,$T_{sw}$ ,$2 T_{sw}$,$3 T_{sw} $},
                xmin=-0.1,xmax=2.2,
                ymin=-1,ymax=1.2,
                ]

          \newcommand\xtauA{7)};
          \newcommand\ioA{0.65};
          \newcommand\xtauB{10};
          \newcommand\ioB{-0.35};

          \addplot [thick,]   coordinates { (0,0) (0.1,0) (0.1,\ioA)};
          \addplot [thick,domain=0.1:1]   { \ioA*(  exp(-(x-0.1)/(\xtauA))) };
          \addplot [thick,domain=1:2]   coordinates { (1, { \ioA*exp(-(1-0.1)/(\xtauA))} ) (1,\ioB)};
          \addplot [thick,domain=1:2]   { \ioB*(  exp(-(x-1)/(\xtauB))) };
          \addplot [thick]   coordinates { (2, {\ioB*exp(-(1)/(\xtauB))} ) (2,\ioA)};
          


        \end{axis}
    \end{tikzpicture}
    \caption{Fast Switching Limit}
    \label{fig:ic_fsl}
\end{subfigure}
\caption{Current waveforms though the capacitors in each of the two regimes of operation. }
\label{fig:capacitor_current}
\end{figure}


\subsection{Revising the charge flow analysis}



The charge flow analysis method is based on charge conservation in the capacitors during a switching period when the converter is in steady state~\cite{95Makowski}. Based on the charge flow of the capacitors, the converter is studied in two well-defined operating regimes: the Slow Switching Limit (SSL) and the Fast Switching Limit (FSL). In SSL, losses are then dominated by the charge transfer between capacitors, therefore only the charge transfer loss mechanisms are studied.  In FSL, losses depend on the conduction through the parasitic resistive elements, therefore only the conduction losses are studied. This division in the study of the converter reduces the complexity of the problem, and enables a simplified but accurate analysis.

\subsection{Load Model: Voltage Sink versus Current Sink}

The charge flow method~\cite{95Makowski} makes some assumptions in order to model the SCC. First, the load is modeled as an ideal voltage source since it is normally connected to the \emph{dc}-output in parallel with a large capacitor. This ignores the effects of the output capacitor to the equivalent resistance of the model. Second, the model only considers the \emph{dc}-output as the single load point of the converter, imposing a unique output to the converter. Third, the phase time ratio is not included in the computation of the capacitor charge flow. Consequently, the modulation of the switching period is assumed to have no influence on the amount of charge flowing in the capacitors. These simplifications reduce the usability of the model to the specific application of dc-to-dc conversion, and at the same time limit the flexibility to model different concepts of the SCC, such as the aforementioned hybrid concept. In order to overcome these limitations, the presented methodology makes two different assumptions: First, any of the converter nodes can be loaded. Second, the load is assumed to be a constant current source with a value equal to the average load current.\\


\subsection{Re-formulating the charge flow analysis}

The SSL impedance encompasses the losses produced in the charge transfer from capacitor to capacitor and from voltage supply to capacitor; therefore, for this analysis none of the parasitic resistances are taken into account. As mentioned before, the classical approach to study SCCs is to assume an infinitely large output capacitance connected to a \emph{dc}-node, an approach that has two limitations:
\begin{enumerate}
   \item Produces inaccuracies when the output capacitor is comparable in value to the flying capacitors.
   \item Cannot be used for a converter with a load connected to one of the internal nodes.
\end{enumerate}

\begin{figure}[!h]
\centering
\ctikzset { bipoles/length=1cm}
\begin{subfigure}[t]{.4\textwidth}
    %\centering
    \raggedright
    \begin{circuitikz} [american,scale=0.65]
    \draw
        (0,0) to[V=$v_{src}$] (0,3)
        (3,3) to[pC,l=$c_1$] (0,3)
        (3,0) to[pC,l=$c_2$] (3,3) -- (6,3)
        (6,0) to[pC,l=$c_3$] (6,3) --
        (8,3) to[I,l=$i_o$] (8,0) -- (0,0);
    \begin{scope}[>=latex,thick,text=black]
        \draw [->,rounded corners=7pt,dashed]
            (0.4,2.4) -- (2.4,2.4) -- (2.4,0.4);
        \draw [->,rounded corners=7pt,dashed]
            (3.6,0.5) |- (5.4,2.7) -- (5.4,0.4);
        \draw [->,rounded corners=7pt]
             (6.3,2) |- (8,3.3);
        \draw [>=latex,text=black,dashed]
          (0,4)  -- (0.9,4) node[anchor=west]{Redistributed charge};
        \draw [>=latex,text=black]
          (0,4.5)  -- (0.9,4.5) node[anchor=west]{Pumped charge};
    \end{scope}
    \end{circuitikz}
    \caption{}
\end{subfigure}
\hfill
\hfill
\begin{subfigure}[t]{.4\textwidth}
    %\centering
    \raggedleft
    \begin{circuitikz} [american,scale=0.65]
    \draw
        (1,0) to[V=$v_{src}$] (1,3)
        (6,3) to[pC,l=$c_2$] (3,3)
        (3,0) to[pC,l=$c_1$] (3,3)
        (6,0) to[pC,l=$c_3$] (6,3) --
        (8,3) to[I,l=$i_o$] (8,0) -- (1,0);
    \begin{scope}[>=latex,thick,text=black]
        \draw [->,rounded corners=7pt,dashed]
            (3.6,0.5) |- (5.4,2.4) -- (5.4,0.4);
        \draw [->,rounded corners=7pt]
            (6.3,2) |- (8,3.3);% -- (8.6,0.4);

    \end{scope}
    \end{circuitikz}
    \caption{}
\end{subfigure}
\caption{Charge flows in a Dickson 3:1 converter when loaded at a \emph{dc}-node with a large capacitor during the two switching phases. The solid line marks the pumped charge to the load and the dashed lines the possible paths of the redistributed charge.}
\label{fig:charge_flow_I}
\end{figure}

In the original charge flow analysis of the SSL impedance~\cite{95Makowski}, it is assumed that all of the pumped charge to the load is only supplied by a \emph{dc}-capacitor without any \emph{pumping} contribution from the flying capacitors, as shown in figure~\ref{fig:charge_flow_I}.  However, for a finite value of the output capacitor, or for converters loaded from an internal node, all of the capacitors contribute to pumping charge to the load~\cite{2013Breussegem:c_out}, as shown in figure~\ref{fig:charge_flow_II}. The original analysis omitted the \emph{pumped} charge contribution of the flying capacitors, thereby overestimating the \emph{redistributed} charge, resulting in an overestimation of the SSL impedance.

\begin{figure}[!h]
\centering
\ctikzset { bipoles/length=1cm}
\begin{subfigure}[t]{.4\textwidth}
    %\centering
    \raggedright
    \begin{circuitikz} [american,scale=0.65]
    \draw
        (0,0) to[V=$v_{src}$] (0,3)
        (3,3) to[pC,l=$c_1$] (0,3)
        (3,0) to[pC,l=$c_2$] (3,3) -- (6,3)
        (6,0) to[pC,l=$c_3$] (6,3) --
        (8,3) to[I,l=$i_o$] (8,0) -- (0,0);
    \begin{scope}[>=latex,thick,text=black]
        \draw [->,rounded corners=7pt,dashed]
            (0.4,2.4) -- (2.4,2.4) -- (2.4,0.4);
        \draw [->,rounded corners=7pt,dashed]
            (3.6,0.5) |- (5.4,2.7) -- (5.4,0.4);

        \draw [->,rounded corners=7pt]
            (2,3.3) -- (7,3.3)
            (2.7,2) |- (7.5,3.3)
            (6.3,2) |- (8,3.3);
        \draw [>=latex,text=black,dashed]
          (0,4)  -- (0.9,4) node[anchor=west]{Redistributed charge};
        \draw [>=latex,text=black]
          (0,4.5)  -- (0.9,4.5) node[anchor=west]{Pumped charge};
    \end{scope}


    \end{circuitikz}
    \caption{}
\end{subfigure}
\hfill
\hfill
\begin{subfigure}[t]{.4\textwidth}
    %\centering
    \raggedleft
    \begin{circuitikz} [american,scale=0.65]
    \draw
        (1,0) to[V=$v_{src}$] (1,3)
        (6,3) --  (3,3)
        (3,0) to[pC,l=$c_1$] (3,3)
        (6,0)-- (6,0.25) to[pC,l=$c_3$] (6,1.5) to[pC,l=$c_2$] (6,2.75) |-
        (8,3) to[I,l=$i_o$] (8,0) -- (1,0);
    \begin{scope}[>=latex,thick,text=black]
        \draw [->,rounded corners=7pt,dashed]
            (3.6,0.5) |- (5.4,2.7) -- (5.4,0.4);
        \draw [->,rounded corners=7pt]
             (2.7,2) |- (7.5,3.3)
             (6.3,2.5) |- (8,3.3);% -- (8.6,0.4);
    \end{scope}
    \end{circuitikz}
    \caption{}
\end{subfigure}
\caption{Charge flows in a Dickson 3:1 converter when loaded at one of the \emph{pwm}-nodes during the two switching phases. The \emph{solid} lines marks the pumped charge paths to the load and the \emph{dashed} lines the possible paths of the redistributed charge.}
\label{fig:charge_flow_II}
\end{figure}

In order to overcome the restrictions of the original charge flow methodology, the proposed methodology models the load as a current sink instead of a voltage sink. This slight modification has a relevant change in the modeling of the converter, adding three important aspects to the modeling:
\begin{enumerate}
  \item Connect the load to any of the nodes of the converter, since it does not fix any voltage at the connected node.

  \item Include the \emph{dc}-capacitors in the analysis, since the voltage across the sink is given by the capacitor and not longer by the previous used voltage sink.

  \item Estimate the delivered charge to the load for each of the circuit modes of the converter, since the current sink has a value of the averaged output current.
\end{enumerate}

\begin{figure}[!h]
\centering
\input{./3_modeling/Delta_vc1.tex}
\caption{The two possible voltage waveforms that show the capacitors in a SCC. Ripples are associated with the charge flow mechanisms: top) unipolar capacitor discharge (DC capacitor); bottom) bipolar capacitor discharge (flying capacitor).}
\label{fig:cap_riples}
\end{figure}


\subsubsection[SSL]{Slow Switching Limit}

A charge multiplier vector $\mathbf{a}$ is obtained for all of the operation modes, also known as phases, of the converter. The charge multiplier vector corresponds to the charge flowing in every individual capacitor or source, normalized with respect to the total output charge $q_{out}$, as described in~\cite{95Makowski,Seeman:EECS-2009-78}. Owing to the fact that load current $i_o$ is assumed constant, the output charge of the $j$-phase can be expressed as the ratio of the phase duration $D^j$ to the total switching period $T_{sw}$, and its contribution to the total output charge $q_{out}$ is
\begin{equation}
    q^j_{out} = i_{o} T_{sw} D^j = D^j q_{out} .
\label{eq:qout}
\end{equation}

Each charge flow element $ a(D^j)_i^j$  is a function of the phase duration $D^j$ and corresponds to the total net charge circulating in the $i$-th capacitor $c_i$ during the $j$-th phase, and can be used to compute the $net$ voltage $vn$ variation at the end of the $j$-th phase period:
\begin{equation}
\Delta {vn}^j_i  = \frac{a_i ^j }{c_i} q_{out} .
\label{eq:net_voltage}
\end{equation}

The current flowing through the $i$-th capacitor can be assumed to be constant, since the load has been modeled as a constant current skin. Hence the current in the $i$-th capacitor will a
Due to the approximation of constant load current, it can be assumed that in the $i$-th capacitor the charge to the load is pumped by a constant current $i_i$.

Hence the pumped voltage $vp$ variation during the $j$-th phase of the total switching period $T_{sw}$ can be simply computed as
\begin{equation}
\Delta {vp}^j_i  = \frac{i_i^j}{c_i} T_{sw} D^j = \frac{a_i ^j }{c_i} q_{out} .
\label{eq:pumped_voltage}
\end{equation}

where $b_i^j$ is an equivalent impedance that depends on capacitor values and the circuit configuration during the $j$-th phase. It is easily derived through basic circuit analysis.

As mentioned before, one part of the delta voltage $\Delta vp_i^j$ is due to the charge redistribution and the other is due to the charge pumping. Both can be easily identified from the voltage waveforms that are present on the capacitors, shown in Figure~\ref{fig:cap_riples}. From the graph, the voltage ripple associated with the redistributed charge $\Delta vr$ can be defined as
\begin{equation}
\Delta {vr}^j_i  = {v_n}^j_i + {v_p}^j_i .
\label{eq:rdst_ripple_I}
\end{equation}
The voltage variation due to the charge \emph{redistribution} $\Delta vr$  is obtained by substituting~\ref{eq:net_voltage} and~\ref{eq:pumped_voltage} into~\ref{eq:rdst_ripple_I}, and this yields
\begin{equation}
\Delta {vr}^j_i  = \frac{q_{out}}{c_i} \left[ a^j_i - D^j b^j_i \right] .
\label{eq:rdst_ripple_II}
\end{equation}
The energy lost in the i-th capacitor can be calculated from~\ref{eq:rdst_ripple_II} as
\begin{equation}
E_i^j=\frac{1}{2}{({\Delta{vr}}_i^j)}^2C_i=\frac{1}{2}\frac{{q_{out}}^2}{{c_i}^2}{\left[a_{i\
}^j-{D^j} {b_i^j}\right]}^2c_i=\frac{1}{2}\frac{{q_{out}}^2}{c_i}{\left[a_{i\
}^j-{D^j} {b_i^j}\right]}^2 .
\label{eq:e_lost_ssl}
\end{equation}
The total power loss in the circuit is the sum of the losses in all of the
capacitors during each phase multiplied by the switching frequency$f_{sw}$.
This yield{\small s}
\begin{equation}
P_{ssl}=\frac{f_{sw}{q_{out}}^2}{2}\sum_{i=1}^{caps.}\sum_{j=1}^{phases}\frac{1}{c_i}{\left[a_{i\
}^j-{D^j}{b_i^j}\right]}^2.
\label{eq:pwr_ssl}
\end{equation}

The losses can be expressed as the output SSL impedance by dividing~\ref{eq:pwr_ssl} by the
square of the output current as
\begin{equation}
r_{ssl}=\frac{P_{ssl}}{{i_o}^2}=\frac{P_{ssl}}{{(f_{sw} {q_{out}})}^2}=\frac{1}{2 f_{sw}}\sum_{i=1}^{caps.}\sum_{j=1}^{phases}\frac{1}{c_i}{\left[a_{i\
}^j-{D^j} {b_i^j}\right]}^2.
\label{eq:r_ssl}
\end{equation}

The \textit{target voltage }$v_{trg}$ of the converter is defined as the average output voltage under no load condition, and its relationship with the input voltage $v_{src}$ is equal to the conversion ratio of the converter $m$ used in the model. The conversion ratio of the converter is determined by the converter topology, and it is obtained from
\begin{equation}
m(D^j)=\frac{{v_{trg}}}{V_{src}}=\sum_{j=1}^{phases}a_{in}^j.
\label{eq:r_ssl}
\end{equation}

where $a_{in}$  corresponds to the input voltage source term of the charge
vector multiplier $\mathbf{a}$.

\subsubsection[FSL]{Fast Switching Limit}
The fast switching limit (FSL) impedance accounts for losses produced in the parasitic resistive elements in the circuit composed by the \emph{on}-resistance of the switches and the Equivalent Series Resistance (ESR) of the capacitors. Since this operation limit is characterized by a constant current flow in the capacitors, the FSL impedance may be calculated as in~\cite{Seeman:EECS-2009-78}, except that the charge flow vectors are now functions of the phase ratio durations $D^j$, as previously mentioned. As outlined in~\cite{Seeman:EECS-2009-78}, the charge flow through the parasitic element vectors $\mathbf{ar}$ with resistance value $r$ can be derived using the charge flow vectors $\mathbf{a}$ calculated previously. We obtain:
\begin{equation}
r_{fsl}=\sum_{i=1}^{elm.}\sum_{j=1}^{phases}\frac{r_i}{D^j}{{ar}_{i\ ^j}}^2.
\label{eq:r_ssl}
\end{equation}

\subsubsection{Equivalent Switched Capacitor Converter Resistance}
The best approximation for any arbitrary switching frequency $f_{sw}$, suggested in~\cite{1998Arntzen,1999Maksimovic}, to obtain the total output impedance is given by
\begin{equation}
r_{scc} \approx \sqrt{{r_{ssl}}^2+{r_{fsl}}^2}.
\label{eq:r_scc}
\end{equation}

\subsection{Sensitivity of the inductor current ripple}

\section{Multiple Output Converters}
\subsection{The Output Trans-Resistance Model}
\subsection{Obtaining the Trans-Resistance parameters with the charge flow analysis }



\chapter[Optimization and Design]{Optimization and Design of Hybrid-Switched Capacitor Converters}
\section{Introduction}
\section{Study in the correlation of the design parameters and the Output Impedance}
\section{Encapsulating the Switches and Capacitors area breakdown in an optimization procedure}
\section{Insights towards a complete optimization}

\chapter[Dynamic Study]{Dynamic Study of Hybrid-Switched Capacitor Converters}
\section{Small Signal Analysis}


\clearpage
\bibliographystyle{plainnat}
\bibliography{references} 